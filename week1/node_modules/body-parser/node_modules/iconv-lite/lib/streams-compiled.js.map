{"version":3,"sources":["streams.js"],"names":[],"mappings":"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","file":"streams-compiled.js","sourcesContent":["\"use strict\"\n\nvar Transform = require(\"stream\").Transform;\n\n\n// == Exports ==================================================================\nmodule.exports = function(iconv) {\n    \n    // Additional Public API.\n    iconv.encodeStream = function encodeStream(encoding, options) {\n        return new IconvLiteEncoderStream(iconv.getEncoder(encoding, options), options);\n    }\n\n    iconv.decodeStream = function decodeStream(encoding, options) {\n        return new IconvLiteDecoderStream(iconv.getDecoder(encoding, options), options);\n    }\n\n    iconv.supportsStreams = true;\n\n\n    // Not published yet.\n    iconv.IconvLiteEncoderStream = IconvLiteEncoderStream;\n    iconv.IconvLiteDecoderStream = IconvLiteDecoderStream;\n    iconv._collect = IconvLiteDecoderStream.prototype.collect;\n};\n\n\n// == Encoder stream =======================================================\nfunction IconvLiteEncoderStream(conv, options) {\n    this.conv = conv;\n    options = options || {};\n    options.decodeStrings = false; // We accept only strings, so we don't need to decode them.\n    Transform.call(this, options);\n}\n\nIconvLiteEncoderStream.prototype = Object.create(Transform.prototype, {\n    constructor: { value: IconvLiteEncoderStream }\n});\n\nIconvLiteEncoderStream.prototype._transform = function(chunk, encoding, done) {\n    if (typeof chunk != 'string')\n        return done(new Error(\"Iconv encoding stream needs strings as its input.\"));\n    try {\n        var res = this.conv.write(chunk);\n        if (res && res.length) this.push(res);\n        done();\n    }\n    catch (e) {\n        done(e);\n    }\n}\n\nIconvLiteEncoderStream.prototype._flush = function(done) {\n    try {\n        var res = this.conv.end();\n        if (res && res.length) this.push(res);\n        done();\n    }\n    catch (e) {\n        done(e);\n    }\n}\n\nIconvLiteEncoderStream.prototype.collect = function(cb) {\n    var chunks = [];\n    this.on('error', cb);\n    this.on('data', function(chunk) { chunks.push(chunk); });\n    this.on('end', function() {\n        cb(null, Buffer.concat(chunks));\n    });\n    return this;\n}\n\n\n// == Decoder stream =======================================================\nfunction IconvLiteDecoderStream(conv, options) {\n    this.conv = conv;\n    options = options || {};\n    options.encoding = this.encoding = 'utf8'; // We output strings.\n    Transform.call(this, options);\n}\n\nIconvLiteDecoderStream.prototype = Object.create(Transform.prototype, {\n    constructor: { value: IconvLiteDecoderStream }\n});\n\nIconvLiteDecoderStream.prototype._transform = function(chunk, encoding, done) {\n    if (!Buffer.isBuffer(chunk))\n        return done(new Error(\"Iconv decoding stream needs buffers as its input.\"));\n    try {\n        var res = this.conv.write(chunk);\n        if (res && res.length) this.push(res, this.encoding);\n        done();\n    }\n    catch (e) {\n        done(e);\n    }\n}\n\nIconvLiteDecoderStream.prototype._flush = function(done) {\n    try {\n        var res = this.conv.end();\n        if (res && res.length) this.push(res, this.encoding);                \n        done();\n    }\n    catch (e) {\n        done(e);\n    }\n}\n\nIconvLiteDecoderStream.prototype.collect = function(cb) {\n    var res = '';\n    this.on('error', cb);\n    this.on('data', function(chunk) { res += chunk; });\n    this.on('end', function() {\n        cb(null, res);\n    });\n    return this;\n}\n\n"]}