{"version":3,"sources":["Sequence-compiled.js"],"names":[],"mappings":"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","file":"Sequence-compiled-compiled.js","sourcesContent":["var Util = require('util');\nvar EventEmitter = require('events').EventEmitter;\nvar Packets = require('../packets');\nvar ErrorConstants = require('../constants/errors');\n\n// istanbul ignore next: Node.js < 0.10 not covered\nvar listenerCount = EventEmitter.listenerCount || function (emitter, type) {\n  return emitter.listeners(type).length;\n};\n\nvar LONG_STACK_DELIMITER = '\\n    --------------------\\n';\n\nmodule.exports = Sequence;\nUtil.inherits(Sequence, EventEmitter);\nfunction Sequence(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  EventEmitter.call(this);\n\n  options = options || {};\n\n  this._callback = callback;\n  this._callSite = null;\n  this._ended = false;\n  this._timeout = options.timeout;\n\n  // For Timers\n  this._idleNext = null;\n  this._idlePrev = null;\n  this._idleStart = null;\n  this._idleTimeout = -1;\n  this._repeat = null;\n}\n\nSequence.determinePacket = function (byte) {\n  switch (byte) {\n    case 0x00:\n      return Packets.OkPacket;\n    case 0xfe:\n      return Packets.EofPacket;\n    case 0xff:\n      return Packets.ErrorPacket;\n    default:\n      return undefined;\n  }\n};\n\nSequence.prototype.hasErrorHandler = function () {\n  return Boolean(this._callback) || listenerCount(this, 'error') > 1;\n};\n\nSequence.prototype._packetToError = function (packet) {\n  var code = ErrorConstants[packet.errno] || 'UNKNOWN_CODE_PLEASE_REPORT';\n  var err = new Error(code + ': ' + packet.message);\n  err.code = code;\n  err.errno = packet.errno;\n  err.sqlState = packet.sqlState;\n\n  return err;\n};\n\nSequence.prototype.end = function (err) {\n  if (this._ended) {\n    return;\n  }\n\n  this._ended = true;\n\n  if (err) {\n    this._addLongStackTrace(err);\n  }\n\n  // Without this we are leaking memory. This problem was introduced in\n  // 8189925374e7ce3819bbe88b64c7b15abac96b16. I suspect that the error object\n  // causes a cyclic reference that the GC does not detect properly, but I was\n  // unable to produce a standalone version of this leak. This would be a great\n  // challenge for somebody interested in difficult problems : )!\n  this._callSite = null;\n\n  // try...finally for exception safety\n  try {\n    if (err) {\n      this.emit('error', err);\n    }\n  } finally {\n    try {\n      if (this._callback) {\n        this._callback.apply(this, arguments);\n      }\n    } finally {\n      this.emit('end');\n    }\n  }\n};\n\nSequence.prototype['OkPacket'] = function (packet) {\n  this.end(null, packet);\n};\n\nSequence.prototype['ErrorPacket'] = function (packet) {\n  this.end(this._packetToError(packet));\n};\n\n// Implemented by child classes\nSequence.prototype.start = function () {};\n\nSequence.prototype._addLongStackTrace = function _addLongStackTrace(err) {\n  var callSiteStack = this._callSite && this._callSite.stack;\n\n  if (!callSiteStack || typeof callSiteStack !== 'string') {\n    // No recorded call site\n    return;\n  }\n\n  if (err.stack.indexOf(LONG_STACK_DELIMITER) !== -1) {\n    // Error stack already looks long\n    return;\n  }\n\n  var index = callSiteStack.indexOf('\\n');\n\n  if (index !== -1) {\n    // Append recorded call site\n    err.stack += LONG_STACK_DELIMITER + callSiteStack.substr(index + 1);\n  }\n};\n\nSequence.prototype._onTimeout = function _onTimeout() {\n  this.emit('timeout');\n};\n\n//# sourceMappingURL=Sequence-compiled.js.map"]}